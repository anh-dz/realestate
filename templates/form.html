<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ 'Edit' if property else 'Add' }} Property</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='form.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <div class="top-nav">
            <a href="/" class="btn-back" style="margin-bottom: 0;"><span>‚Üê</span> Back to List</a>
            <button id="theme-toggle" class="btn btn-theme" title="Toggle Dark Mode">üåô</button>
        </div>

        <div class="form-card">
            <div class="form-header">
                <div class="form-title-group">
                    <span class="form-icon">{{ '‚úèÔ∏è' if property else '‚ú®' }}</span>
                    <h1>{{ 'Edit Property Details' if property else 'Add New Property' }}</h1>
                </div>
            </div>

            <form method="POST">
                
                <!-- 1. LOCATION & BASIC INFO -->
                <div class="form-section-title" style="margin-top: 0;">1. Location & Info</div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>District *</label>
                            <select name="district_id" required>
                                {% for d in districts %}
                                <option value="{{ d['district_id'] }}" 
                                    {% if property and property['district_id'] == d['district_id'] %}selected{% endif %}>
                                    {{ d['district_name'] }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-col" style="flex: 2;">
                        <div class="form-group">
                            <label>Address *</label>
                            <input type="text" name="address" value="{{ property['address'] if property else '' }}" required placeholder="e.g. No. 123, Sec 1, Xinyi Rd">
                        </div>
                    </div>
                </div>

                <!-- 2. BUILDING DETAILS -->
                <div class="form-section-title">2. Building Specs</div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>Building Type *</label>
                            <select name="building_type" required>
                                <option value="" disabled selected>Select Type</option>
                                {% for b in building_types %}
                                <option value="{{ b['building_type'] }}"
                                    {% if property and property['building_type'] == b['building_type'] %}selected{% endif %}>
                                    {{ b['building_type'] }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Material (Select)</label>
                            {% if materials %}
                            <select name="building_materials">
                                <option value="">None / Unknown</option>
                                {% for m in materials %}
                                <option value="{{ m['building_materials'] }}"
                                    {% if property and property['building_materials'] == m['building_materials'] %}selected{% endif %}>
                                    {{ m['building_materials'] }}
                                </option>
                                {% endfor %}
                            </select>
                            {% else %}
                            <input type="text" name="building_materials" value="{{ property['building_materials'] if property else '' }}">
                            {% endif %}
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Total Floors</label>
                            <input type="number" name="floor_count" value="{{ property['floor_count'] if property else '' }}" placeholder="e.g. 12">
                        </div>
                    </div>
                </div>

                <!-- 3. LAYOUT (ENGLISH) -->
                <div class="form-section-title">3. Layout Configuration</div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>Rooms</label>
                            <input type="number" name="room_count" value="{{ property['room_count'] if property else 0 }}" min="0">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Halls</label>
                            <input type="number" name="hall_count" value="{{ property['hall_count'] if property else 0 }}" min="0">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Bathrooms</label>
                            <input type="number" name="bathroom_count" value="{{ property['bathroom_count'] if property else 0 }}" min="0">
                        </div>
                    </div>
                    
                    <!-- Balcony field updated (Label top, Input bottom) -->
                    <div class="form-col checkbox-wrapper">
                        <label class="balcony">Has Balcony</label> 
                        <div class="checkbox-container"> 
                            <input type="checkbox" name="balcony" id="balcony" {% if property and property['balcony'] %}checked{% endif %}>
                        </div>
                    </div>
                </div>

                <!-- 4. PARKING -->
                <div class="form-section-title">4. Parking Facilities</div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>Parking Type (Select)</label>
                            {% if parking_types %}
                            <select name="parking_type">
                                <option value="">No Parking</option>
                                {% for p in parking_types %}
                                <option value="{{ p['parking_type'] }}"
                                    {% if property and property['parking_type'] == p['parking_type'] %}selected{% endif %}>
                                    {{ p['parking_type'] }}
                                </option>
                                {% endfor %}
                            </select>
                            {% else %}
                            <input type="text" name="parking_type" value="{{ property['parking_type'] if property and property['parking_type'] != 'nan' else '' }}">
                            {% endif %}
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Parking Price (TWD)</label>
                            <input type="number" name="parking_price" value="{{ property['parking_price'] if property else 0 }}">
                        </div>
                    </div>
                </div>

                <!-- 5. FINANCIALS -->
                <div class="form-section-title">5. Financials</div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>Price per m¬≤ (TWD) *</label>
                            <input type="number" name="price_per_sqm" value="{{ property['price_per_sqm'] if property else '' }}" required placeholder="e.g. 850000">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Transaction Date</label>
                            <input type="date" name="transaction_date" value="{{ property['transaction_date'] if property else '' }}">
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-submit" style="background-color: #28a745; width: auto; flex: 2; font-weight: 600;">
                        {{ 'Save Changes' if property else 'Create Property' }}
                    </button>
                    <a href="/" class="btn btn-reset" style="text-align: center; width: auto; flex: 1;">Cancel</a>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>